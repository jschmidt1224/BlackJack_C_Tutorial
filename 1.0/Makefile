#############################################################################
# Simple build system
#############################################################################

# 1. All .c files bellow SOURCE_DIR are compiled

#############################################################################
# Project information
#############################################################################

PROJECT_NAME=blackjack.exe

#############################################################################
# Configuration variables
#############################################################################

OUTPUT_DIR=build
SOURCE_DIR=src
INCLUDE_DIR=include
LIB_DIR=lib

SOURCE_FILES_C = $(shell find $(SOURCE_DIR) -name "*.c")

OBJS = $(addprefix $(OUTPUT_DIR)/, $(SOURCE_FILES_C:%.c=%.o))
AUTODEP_FILES = $(OBJS:%.o=%.d)

#############################################################################
# Compiler flags
############################################################################# 

CPPFLAGS = -Wall -W -Wextra -Werror
CPPFLAGS += -I$(INCLUDE_DIR) -g

LDFLAGS =

#############################################################################
# Toolchain
#############################################################################

CC=gcc

#############################################################################
# Rules
#############################################################################

all: $(PROJECT_NAME)

$(PROJECT_NAME): $(OBJS)
	@echo [LD] $@
	@$(CC) $(CPPFLAGS) $(OBJS) -o $@ $(LDFLAGS)


.PHONY: clean
clean:
	@echo [CLEAN]
	@rm -rf $(OUTPUT_DIR)
	@rm -f $(PROJECT_NAME)

-include $(AUTODEP_FILES)

#############################################################################
# Suffix Rules
#############################################################################

$(OBJS): $(OUTPUT_DIR)/%.o : %.c
	@echo [CC] $<
	@mkdir -p $(dir $@)
	@$(CC) -MMD $(CPPFLAGS) -c -o $@ $<
